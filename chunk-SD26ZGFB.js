import{b}from"./chunk-MLIP6L5G.js";import{a as u,b as n,c as g,g as f}from"./chunk-LTY4KBVV.js";import{R as m,W as o,ic as l,l as s,o as h,x as a}from"./chunk-VBLDOLAL.js";import{a as c}from"./chunk-2NFLSA4Y.js";var k=class i{constructor(e,t,r){this.http=e;this.router=t;this.snackbar=r}baseURl=u.apiUrl;login(e){this.http.post(`${this.baseURl}/auth/login`,e,{observe:"response"}).pipe(a(t=>s(()=>t))).subscribe({next:t=>{let r=t.headers.get("Authorization");if(r)sessionStorage.setItem("token",r);else throw new Error("No se ha recibido el token");let p=JSON.parse(atob(r.split(".")[1]));console.log("Decoded Token:",p),this.navigate(p.isDoctor?"/home/doctor":"/home")},error:t=>{t.status==401&&this.snackbar.open("Usuario o contrase\xF1a incorrectos","Ok",{duration:5e3,panelClass:["error-snackbar","mb-5"],horizontalPosition:"right",verticalPosition:"top"})}})}navigate(e){this.router.navigate([e]).then()}register(e){this.http.post(`${this.baseURl}/auth/register`,n(e),{observe:"response"}).pipe(a(t=>s(()=>t))).subscribe({next:t=>{let r=t.headers.get("Authorization");if(r)sessionStorage.setItem("token",r);else throw new Error("No se ha recibido el token");this.router.navigate(["home"]).then()},error:t=>{console.error("Register error",t),this.snackbar.open(t.error.message,"Ok",{duration:5e3,panelClass:["error-snackbar","mb-5"],horizontalPosition:"right",verticalPosition:"top"})}})}getUserInfo(){return this.http.get(`${this.baseURl}/user`,{observe:"response"}).pipe(h(e=>{let t=g(e.body);return e.clone({body:t})}))}updateUserInfo(e){return e=n(e),this.http.put(`${this.baseURl}/user`,c({},e),{observe:"response"})}isAuthenticated(){return!!sessionStorage.getItem("token")}static \u0275fac=function(t){return new(t||i)(o(l),o(b),o(f))};static \u0275prov=m({token:i,factory:i.\u0275fac,providedIn:"root"})};export{k as a};
