import{a as T}from"./chunk-YHWIT47B.js";import{a as ie,c as ne,d as ae,e as oe,f as re,g as le,h as pe,i as se,j as me,k as de,n as w,o as ce,p as ge,q as ue,r as fe,s as ve,t as he,u as _e,v as Ce}from"./chunk-GEROILSD.js";import"./chunk-Z3WYQJI3.js";import"./chunk-I24E4AGB.js";import{o as Z,s as ee,x as te}from"./chunk-P3OJ7RPL.js";import{g as K}from"./chunk-J74PXQCH.js";import{a as J,b as X}from"./chunk-RSJPXRVQ.js";import{$b as $,Ab as B,Bb as R,Ca as C,Cb as G,Eb as L,Fb as A,Ib as u,Jb as I,Ka as M,Lb as D,Mb as Y,Pa as f,Pb as z,Va as d,X as V,_b as j,ac as H,ad as U,bd as E,ca as h,cb as n,cc as Q,da as _,db as a,dc as b,ec as W,fc as q,ib as x,k as v,kb as y,lb as g,pb as F,qb as P,rb as N,vb as k,wb as o,xb as S,ya as p,yb as m}from"./chunk-VBLDOLAL.js";import"./chunk-2NFLSA4Y.js";var xe=()=>[],ye=()=>[10,25,50,100];function we(r,i){if(r&1&&(n(0,"span",20),o(1),a()),r&2){let e=g().$implicit,t=g(3);d("ngClass",t.getColorText(e.status)),p(),S(e.status)}}function Me(r,i){if(r&1){let e=x();n(0,"div",17)(1,"mat-card",18),y("click",function(){let l=h(e).$implicit,s=g(3);return _(s.onCardClick(l.appointmentId))}),n(2,"mat-card-header")(3,"mat-card-subtitle"),o(4),u(5,"date"),f(6,we,2,2,"span",19),a()(),n(7,"mat-card-content")(8,"p"),o(9),a(),n(10,"p"),o(11),a()()()()}if(r&2){let e=i.$implicit;p(4),m(" ",D(5,4,e.startTime,"shortTime","GMT-5","es-CO")," "),p(2),d("ngIf",e.status!=="PENDIENTE"),p(3),m("Especialidad: ",e.specialtyName,""),p(2),m("Paciente: ",e.patientName,"")}}function Se(r,i){if(r&1&&(n(0,"div")(1,"div",14),o(2),a(),n(3,"div",15),f(4,Me,12,9,"div",16),a()()),r&2){let e=i.$implicit;p(2),S(e.key),p(2),d("ngForOf",e.value)}}function Ae(r,i){if(r&1&&(n(0,"div",12),f(1,Se,5,2,"div",13),u(2,"async"),u(3,"keyvalue"),a()),r&2){let e,t=g();p(),d("ngForOf",I(3,3,(e=I(2,1,t.groupedAppointments$))!==null&&e!==void 0?e:A(5,xe)))}}function Ie(r,i){r&1&&(n(0,"div",21)(1,"mat-icon",22),o(2,"info"),a(),n(3,"p",23),o(4," Parece que no tienes citas programadas. "),a()())}function be(r,i){if(r&1){let e=x();n(0,"mat-paginator",24),y("page",function(l){h(e);let s=g();return _(s.handlePageEvent(l))}),a()}if(r&2){let e=g();d("length",e.totalAppointments)("pageIndex",0)("pageSize",25)("pageSizeOptions",A(5,ye))("showFirstLastButtons",!0)}}q(pe);var De=class r{constructor(i,e,t){this.appointmentService=i;this.dialog=e;this.snackbar=t}doctorAppointments$=v([]);groupedAppointments$=v({});thereIsContent=!0;paginator;totalAppointments=0;selectedFilter="TODAY";ngOnInit(){this.fetchAppointments("TODAY",0,28)}ngAfterViewInit(){}fetchAppointments(i,e,t){this.appointmentService.getDoctorAppointments(i,e,t).subscribe({next:l=>{let s=l.body;this.thereIsContent=s?.content&&s.content.length>0;let c=s?.content??[];this.totalAppointments=s?.totalElements??0,this.doctorAppointments$=v(c),this.groupedAppointments$=v(this.groupByDay(c))}})}groupByDay(i){return i.reduce((e,t)=>{let l=new Date(t.startTime).toLocaleDateString("es-CO",{weekday:"long",day:"numeric",month:"long",year:"numeric"});return e[l]||(e[l]=[]),e[l].push(t),e},{})}handlePageEvent(i){console.log(i),this.thereIsContent=!0,this.fetchAppointments(this.selectedFilter,i.pageIndex,i.pageSize)}handleFilterChange(i){this.thereIsContent=!0,this.fetchAppointments(i.value,0,28)}getColorText(i){switch(i){case"PERDIDA":return"text-red-500";case"ASISTIDA":return"text-green-500";case"PENDIENTE":return"text-yellow-500";default:return""}}onCardClick(i){this.appointmentService.getAppointmentDetail(i).subscribe({next:e=>{this.dialog.open(O,{data:e.body,width:"500px"}).afterClosed().subscribe(l=>{l&&this.appointmentService.markAsAttended(i).subscribe({next:()=>{this.snackbar.open("Se marc\xF3 la cita como asistida","Ok",{duration:5e3,panelClass:["mb-5"],horizontalPosition:"right",verticalPosition:"top"}),this.fetchAppointments(this.selectedFilter,0,28)}})})}})}static \u0275fac=function(e){return new(e||r)(C(le),C(fe),C(K))};static \u0275cmp=M({type:r,selectors:[["app-doctor-view"]],viewQuery:function(e,t){if(e&1&&F(w,5),e&2){let l;P(l=N())&&(t.paginator=l.first)}},features:[L([{provide:z,useValue:"es-CO"}])],decls:17,vars:4,consts:[["noData",""],[1,"flex","flex-col","w-full"],[1,"pt-5","pl-5","mb-3"],[1,"text-lg","mb-4"],[1,"mat-mdc-chip-set","w-full","mb-4",3,"ngModelChange","change","ngModel"],[1,"w-full"],[1,"flex","flex-wrap","gap-2","ml-3"],["value","TODAY","selected",""],["value","PENDING"],["value","PAST"],["class","space-y-6",4,"ngIf","ngIfElse"],["style","--mat-sys-surface: #f0f9ff","class","w-full bg-white p-4","aria-label","Select page",3,"length","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons","page",4,"ngIf"],[1,"space-y-6"],[4,"ngFor","ngForOf"],[1,"text-xl","mb-2"],[1,"flex","flex-wrap","gap-4"],["class","flex-shrink-0",4,"ngFor","ngForOf"],[1,"flex-shrink-0"],["appearance","outlined",1,"transition","hover:scale-103","h-auto","w-[20rem]","bg-red-50","inline-flex",2,"--mat-sys-surface","#f0f9ff",3,"click"],["class","text-sm ml-5",3,"ngClass",4,"ngIf"],[1,"text-sm","ml-5",3,"ngClass"],[1,"flex","flex-col","items-center","justify-center","h-96"],[1,"text-6xl","text-gray-400"],[1,"text-gray-600","mt-4"],["aria-label","Select page",1,"w-full","bg-white","p-4",2,"--mat-sys-surface","#f0f9ff",3,"page","length","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons"]],template:function(e,t){if(e&1){let l=x();n(0,"div",1)(1,"div",2)(2,"div",3),o(3,"Historial de citas"),a(),n(4,"mat-chip-listbox",4),G("ngModelChange",function(c){return h(l),R(t.selectedFilter,c)||(t.selectedFilter=c),_(c)}),y("change",function(c){return h(l),_(t.handleFilterChange(c))}),n(5,"div",5)(6,"div",6)(7,"mat-chip-option",7),o(8,"HOY"),a(),n(9,"mat-chip-option",8),o(10,"FUTURO"),a(),n(11,"mat-chip-option",9),o(12,"OTRAS"),a()()()(),f(13,Ae,4,6,"div",10)(14,Ie,5,0,"ng-template",null,0,Y),a(),f(16,be,1,6,"mat-paginator",11),a()}if(e&2){let l=k(15);p(4),B("ngModel",t.selectedFilter),p(9),d("ngIf",t.thereIsContent)("ngIfElse",l),p(3),d("ngIf",t.selectedFilter!=="TODAY"&&t.thereIsContent)}},dependencies:[ce,w,Q,re,ie,ne,oe,ae,b,$,E,de,me,se,W,te,Z,ee,H,X,J,j],encapsulation:2})},O=class r{constructor(i){this.data=i}dialogRef=V(ge);appointment=null;genders=T;ngOnInit(){this.appointment=this.data}calculateAge(i){if(!i)return 0;let e=new Date(i),t=new Date,l=t.getFullYear()-e.getFullYear(),s=t.getMonth()-e.getMonth();return(s<0||s===0&&t.getDate()<e.getDate())&&l--,l}getGenderValue(i){return i&&T.filter(e=>e.value===i)[0]?.viewValue||"No especificado"}static \u0275fac=function(e){return new(e||r)(C(ue))};static \u0275cmp=M({type:r,selectors:[["dialog-animations-example-dialog"]],decls:31,vars:24,consts:[["mat-dialog-title",""],[1,"gap-2"],[1,"text-lg"],[1,"gap-2","mt-3"],["mat-button","","mat-dialog-close","","cdkFocusInitial","",3,"matDialogClose"],["mat-button","","mat-dialog-close","",3,"matDialogClose"]],template:function(e,t){e&1&&(n(0,"h2",0),o(1,"Mas informaci\xF3n"),a(),n(2,"mat-dialog-content")(3,"div",1)(4,"div",2),o(5,"Cita"),a(),n(6,"div"),o(7),a(),n(8,"div"),o(9),u(10,"date"),a(),n(11,"div"),o(12),u(13,"date"),a()(),n(14,"div",3)(15,"div",2),o(16,"Paciente"),a(),n(17,"div"),o(18),a(),n(19,"div"),o(20),u(21,"date"),a(),n(22,"div"),o(23),a(),n(24,"div"),o(25),a()()(),n(26,"mat-dialog-actions")(27,"button",4),o(28," Salir "),a(),n(29,"button",5),o(30,"Atendida"),a()()),e&2&&(p(7),m("Especialidad: ",t.appointment==null?null:t.appointment.appointment.specialtyName,""),p(2),m(" Fecha: ",D(10,9,t.appointment==null?null:t.appointment.appointment.date,"dd/MM/yyyy","GMT-5","es-CO")," "),p(3),m(" Hora: ",D(13,14,t.appointment==null?null:t.appointment.appointment.date,"shortTime","GMT-5","es-CO")," "),p(6),m("Nombre: ",t.appointment==null?null:t.appointment.patient.name,""),p(2),m(" Fecha de nacimiento: ",D(21,19,t.appointment==null?null:t.appointment.patient.dob,"dd/MM/yyyy","GMT-5","es-CO")," "),p(3),m(" Edad: ",t.calculateAge(t.appointment==null?null:t.appointment.patient.dob)," a\xF1os "),p(2),m(" Genero: ",t.getGenderValue(t.appointment==null||t.appointment.patient==null?null:t.appointment.patient.gender)," "),p(2),d("matDialogClose",!1),p(2),d("matDialogClose",!0))},dependencies:[E,U,Ce,ve,he,_e,b],encapsulation:2,changeDetection:0})};export{De as DoctorViewComponent,O as MarkAttendedDialog};
